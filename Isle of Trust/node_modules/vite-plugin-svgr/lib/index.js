"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
const fs_1 = __importDefault(require("fs"));
module.exports = function svgrPlugin() {
    // TODO: options
    return {
        name: 'vite:svgr',
        async transform(code, id) {
            if (id.endsWith('.svg')) {
                const svgr = require('@svgr/core').default;
                const esbuild = require('esbuild');
                const svg = await fs_1.default.promises.readFile(id, 'utf8');
                const componentCode = await svgr(svg, {}, { componentName: 'ReactComponent' }).then((res) => {
                    return res.replace('export default ReactComponent', `export { ReactComponent }`);
                });
                const res = await esbuild.transform(componentCode + '\n' + code, {
                    loader: 'jsx',
                });
                return {
                    code: res.code,
                    // map: res.map, // TODO:
                };
            }
        },
    };
};
